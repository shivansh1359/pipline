<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShareConnect</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .chat-area { border: 1px solid #ccc; height: 200px; overflow-y: auto; padding: 10px; margin-bottom: 10px; }
    canvas { border: 1px solid #000; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>ShareConnect</h1>

  <div>
    <strong>Room Code:</strong>
    <span id="roomCode">ABC123</span>
    <button onclick="generateCode()">New</button>
    <button onclick="copyCode()">Copy</button>
  </div>

  <div>
    <input id="joinCode" placeholder="Enter room code" />
    <button onclick="joinRoom()">Join</button>
  </div>

  <div class="chat-area" id="chatArea"></div>
  <input id="messageInput" placeholder="Type message and press Enter" />
  <button onclick="sendMessage()">Send</button>

  <canvas id="whiteboard" width="800" height="300"></canvas>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io();
    let roomCode = document.getElementById("roomCode").textContent;

    function addMessage(sender, text) {
      const area = document.getElementById("chatArea");
      const d = document.createElement("div");
      d.innerHTML = "<b>" + sender + ":</b> " + text;
      area.appendChild(d);
      area.scrollTop = area.scrollHeight;
    }

    function generateCode() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      roomCode = "";
      for (let i=0; i<6; i++) roomCode += chars[Math.floor(Math.random()*chars.length)];
      document.getElementById("roomCode").textContent = roomCode;
      addMessage("System", "New room: " + roomCode);
    }

    function copyCode() {
      navigator.clipboard.writeText(roomCode);
      addMessage("System", "Room copied");
    }

    function joinRoom() {
      const code = document.getElementById("joinCode").value.trim().toUpperCase();
      if (!code) return alert("Enter code");
      roomCode = code;
      socket.emit("join-room", code);
      addMessage("System", "Joined " + code);
    }

    function sendMessage() {
      const input = document.getElementById("messageInput");
      const msg = input.value.trim();
      if (!msg) return;
      socket.emit("message", { sender: "You", text: msg, room: roomCode });
      addMessage("You", msg);
      input.value = "";
    }

    document.getElementById("messageInput").addEventListener("keypress", e=>{
      if (e.key==="Enter") sendMessage();
    });

    socket.on("message", data=>{
      addMessage(data.sender || "Friend", data.text || "");
    });

    // Whiteboard
    const canvas = document.getElementById("whiteboard");
    const ctx = canvas.getContext("2d");
    let drawing=false;
    canvas.addEventListener("mousedown", ()=>drawing=true);
    canvas.addEventListener("mouseup", ()=>drawing=false);
    canvas.addEventListener("mousemove", e=>{
      if (!drawing) return;
      const rect = canvas.getBoundingClientRect();
      const x=e.clientX-rect.left, y=e.clientY-rect.top;
      draw(x,y,"black",2,true);
    });
    function draw(x,y,color,size,emit){
      ctx.fillStyle=color;
      ctx.beginPath(); ctx.arc(x,y,size,0,Math.PI*2); ctx.fill();
      if (emit) socket.emit("draw",{room:roomCode,x,y,color,size});
    }
    socket.on("draw", data=>{
      draw(data.x,data.y,data.color,data.size,false);
    });
  </script>
</body>
</html>
